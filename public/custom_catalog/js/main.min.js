function removeErrors() {
    $('.messageError').remove()
    $('span.eror.active').each(function (i, el) {
        $(el).removeClass('active')
    })
}

function FormSubmit(form, callback) {
    var data = {
        location: location.href
    }
    $(form).find('input[name]').each(function () {
        if ($(this).attr('name') == 'phone') {
            data[$(this).attr('name')] = $(this).val().replace(/[^0-9]/gi, '');
        } else {
            data[$(this).attr('name')] = $(this).val();
        }
    });
    removeErrors();
    $.post(location.protocol + '//' + location.host + '/form_submit',
        data,
        function (response) {
            callback();
            $(form).find('input[type!="hidden"][name]').val('')
        }).fail(function (reject) {
        if (reject.responseJSON) {
            var errors = reject.responseJSON;
            for (var key in errors['errors']) {
                var input = $(form).find('input[name="' + key + '"]');
                if (input.length) {
                    $(errors['errors'][key]).each(function (i, message) {
                        $(input).prev().addClass('active').parent().append($('<div class="messageError active"><small>' + message + '</small></div>'));
                    });
                }
            }
        }
    });
    return false;
}

// document.addEventListener("touchstart", function () {
// }, !0);

$(document).ready(function () {
    function a(a) {
        var b = $(a), c = b.children("ul");
        b.children(".dropdown").addClass("hover"), c.css({display: "block"}), d.addClass("bg")
    }

    function b(a) {
        var b = $(a), c = b.children("ul");
        b.find(".dropdown").removeClass("hover"), c.css("display", "none"), d.removeClass("bg")
    }

    $(".open-menu").on("click", function () {
        $(".menu-mobile").toggleClass("active")
    });
    $(".cloze-menu").on("click", function () {
        $(".menu-mobile").removeClass("active")
    });
    $(".moon").on("click", function () {
        $(this).addClass("active");
        $(".body").addClass("dark");
        $(".sun").removeClass("active")
    });
    $(".sun").on("click", function () {
        $(".moon").removeClass("active");
        $(this).addClass("active");
        $(".body").removeClass("dark")
    });
    $(window).width() < 768 && ($(".dropdown").on("click", function () {
        $(this).toggleClass("active")
    }), jQuery(function (a) {
        a(document).mouseup(function (b) {
            var c = a(".dropdown");
            c.is(b.target) || 0 !== c.has(b.target).length || c.removeClass("active")
        })
    }));
    var c = $(".menu-mobile .nav ul"), d = $(".menu-mobile .nav");
    if ($(window).width() > 768) {
        jQuery(function (a) {
            a(document).mouseup(function (b) {
                var c = a(".menu-mobile");
                c.is(b.target) || 0 !== c.has(b.target).length || c.removeClass("active")
            })
        });
        c.menuAim({activate: a, deactivate: b});
        $(document).click(function () {
            $(".menu-mobile .dropdown.hover").removeClass("hover");
            $(".menu-mobile .popover").css("display", "none"), d.removeClass("bg");
            $(".menu-mobile .nav ul ul").css("display", "none")
        });
    }


    jQuery(function (a) {
        a(document).mouseup(function (b) {
            var c = a(".modall-body");
            c.is(b.target) || 0 !== c.has(b.target).length || (c.removeClass("active-modall"), a(".modall").removeClass("active-modall"), a(".body").removeClass("showing-modal"))
        })
    });

    $(".close, ok").on("click", function () {
        $(".modall").removeClass("active-modall");
        $(".body").removeClass("showing-modal")
    });

    $(".request").on("click", function () {
        $(".modall").removeClass("active-modall");
        $(".modall-request").addClass("active-modall");
        $(".body").addClass("showing-modal")
    });

    $(".popup-card").on("click", function () {
        $(".modall").removeClass("active-modall");
        $(".modall-card").addClass("active-modall");
        $(".body").addClass("showing-modal")
    });

    $(".reply").on("click", function (event) {
        event.preventDefault();
        FormSubmit($(this).closest('form'), function () {
            $(".modall").removeClass("active-modall");
            $(".modall-reply").addClass("active-modall");
            $(".body").addClass("showing-modal")
        })
    });

    jQuery(".only_number").keypress(function (a) {
        if (8 != a.which && 0 != a.which && 46 != a.which && (a.which < 48 || a.which > 57)) return !1
    }).on('input', function (e) {
        var v = e.target.value;
        if (v.length > 5) {
            //+7 (343) 43
            e.target.value = v.replace(/(\+7\s\()(7|8)(.+)/i, '$1$3')
        }
    });

    $(".phone_mask").mask("+7 (999) 999 99 9999999", {
        placeholder: "Ваш номер телефона",
        completed: function () {/* ???? */
            console.log(this.value)
        }
    });
});
